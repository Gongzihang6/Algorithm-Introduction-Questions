# 卡特兰数 (Catalan numbers)

卡特兰数是一类在组合数学中常见的数列，得名于比利时数学家欧仁·查理·卡特兰（Eugène Charles Catalan）。它在许多计数问题中有广泛应用，比如二叉树结构、括号匹配、路径计数等。

## 卡特兰数的定义

卡特兰数的第 $n$ 项（通常记作 $C_n$）可以用以下公式表示：

1. 递推公式：
   $$
   C_0 = 1, \quad C_{n+1} = \sum_{i=0}^{n} C_i \cdot C_{n-i}
   $$
   即，每一项等于前面所有项的两两乘积之和。

2. 封闭形式（通项公式）：
   $$
   C_n = \frac{1}{n+1} \binom{2n}{n} = \frac{(2n)!}{(n+1)! \cdot n!}
   $$
   其中 $\binom{2n}{n}$ 是二项式系数。

卡特兰数的前几项：

- 前几项卡特兰数为：
  $$
  C_0 = 1, \quad C_1 = 1, \quad C_2 = 2, \quad C_3 = 5, \quad C_4 = 14, \quad C_5 = 42, \quad \ldots
  $$

## 卡特兰数的应用

卡特兰数出现在许多组合问题中，例如：

1. 合法的括号序列：$n$ 对括号有多少种合法的匹配方式？
   - 例如 $n = 2$ 时：()() 和 ()()，共 $C_2 = 2$ 种。
2. 二叉树的结构：$n$ 个节点可以组成多少种不同的满二叉树（或二叉搜索树）？
   - 例如 $n = 3$ 时，有 $C_3 = 5$ 种不同的二叉树。
3. Dyck 路径：在 $n \times n$ 的网格中，从 $(0,0)$ 到 $(n,n)$ 不越过对角线的路径数。
   - 例如 $n = 2$ 时，有 $C_2 = 2$ 种合法路径。
4. 凸多边形的三角划分：$n+2$ 条边的凸多边形可以划分成多少个三角形？
   - 例如四边形（$n = 2$）有 $C_2 = 2$ 种划分方式。
5. 栈的出入序列：给定一个栈，有多少种不同的入栈和出栈顺序？
   - 例如 $n = 3$ 时，有 $C_3 = 5$ 种合法序列。

## 卡特兰数的性质

- 渐进行为：当 $n$ 很大时，卡特兰数近似为：
  $$
  C_n \sim \frac{4^n}{n^{3/2} \sqrt{\pi}}
  $$
- 生成函数：卡特兰数的生成函数 $G(x)$ 满足：
  $$
  G(x) = \sum_{n=0}^{\infty} C_n x^n = \frac{1 - \sqrt{1 - 4x}}{2x}
  $$

卡特兰数在计算机科学、组合数学和离散数学中有广泛应用，是一个非常有趣且实用的数列！

---

# 卡特兰数 (Catalan numbers) 的通项公式和递推公式理解

下面我们逐步解释 $C_n$ 的定义，并推导它们的来源。

## 1. 递推公式的理解与推导

递推公式：
$$
C_0 = 1, \quad C_{n+1} = \sum_{i=0}^{n} C_i \cdot C_{n-i}
$$

### 组合解释

递推关系通常出现在分治问题中，即一个问题可以分解为两个独立的子问题。例如：

- 合法的括号序列：对于 $n$ 对括号，第一个（必须与某个）匹配，假设匹配的位置是第 $2k$ 个字符（$1 \leq k \leq n$），则：
  - 内部 $2k - 2$ 个字符是一个合法的 $k - 1$ 对括号序列（共 $C_{k-1}$ 种）。
  - 外部剩下的 $2n - 2k$ 个字符是一个合法的 $n - k$ 对括号序列（共 $C_{n-k}$ 种）。
  - 因此，总数为：
    $$
    C_n = \sum_{k=1}^{n} C_{k-1} \cdot C_{n-k}
    $$
    令 $i = k - 1$，则变成：
    $$
    C_n = \sum_{i=0}^{n-1} C_i \cdot C_{n-i}
    $$

这与递推公式一致。

- 二叉树的结构：$n$ 个节点构成的二叉树可以分解为：
  - 左子树有 $i$ 个节点（$C_i$ 种）。
  - 右子树有 $n - 1 - i$ 个节点（$C_{n-1-i}$ 种）。
  - 因此：
    $$
    C_n = \sum_{i=0}^{n-1} C_i \cdot C_{n-1-i}
    $$

这与递推公式一致。

## 2. 通项公式的推导

通项公式：
$$
C_n = \frac{1}{n+1} \binom{2n}{n}
$$

### 推导方法

#### (1) 生成函数法

定义卡特兰数的生成函数：
$$
G(x) = \sum_{n=0}^{\infty} C_n x^n
$$

由于递推关系 $C_{n+1} = \sum_{i=0}^{n} C_i C_{n-i}$，可以写出：
$$
G(x) = 1 + x G(x)^2
$$

解这个二次方程：
$$
G(x)^2 - \frac{1}{x} G(x) + \frac{1}{x} = 0
$$

解得：
$$
G(x) = \frac{1 - \sqrt{1 - 4x}}{2x}
$$

（舍去 + 的解，因为 $G(0) = C_0 = 1$ 必须成立）

利用二项式定理展开 $\sqrt{1 - 4x}$：
$$
(1 - 4x)^{1/2} = \sum_{k=0}^{\infty} \binom{1/2}{k} (-4x)^k
$$

其中：
$$
\binom{1/2}{k} = \frac{(1/2)(-1/2)(-3/2)\cdots((1/2 - k + 1)}{k!}
$$

计算后可得：
$$
\sqrt{1 - 4x} = 1 - 2x - 2x^2 - 4x^3 - \cdots
$$

因此：
$$
G(x) = \frac{1 - (1 - 2x - 2x^2 - \cdots)}{2x} = \sum_{n=0}^{\infty} \frac{1}{n+1} \binom{2n}{n} x^n
$$

于是：
$$
C_n = \frac{1}{n+1} \binom{2n}{n}
$$

#### (2) 反射原理（组合证明）

考虑Dyck 路径（从 $(0,0)$ 到 $(n,n)$，不越过对角线的路径数）：

- 所有路径总数是 $\binom{2n}{n}$（从 $2n$ 步中选 $n$ 步向上）。
- 非法路径（越过对角线的路径）可以通过反射法计算：
  - 第一次跳到 $y = x + 1$ 时，反射后面的路径。反射的路径对称于从 $(0,0)$ 到 $(n-1,n+1)$ 的路径，共 $\binom{2n}{n-1}$ 种。
- 因此，合法路径数为：
  $$
  C_n = \binom{2n}{n} - \binom{2n}{n-1} = \frac{1}{n+1} \binom{2n}{n}
  $$

## 总结

- 递推公式：$C_n = \sum_{i=0}^{n-1} C_i C_{n-1-i}$，适用于动态规划计算。
- 通项公式：$C_n = \frac{1}{n+1} \binom{2n}{n}$，适用于直接计算。
- 推导方法：
  - 递推公式：通过组合分解（括号、二叉树等）得到。
  - 通项公式：生成函数法或反射原理（Dyck 路径计数）。

卡特兰数的美妙之处在于它连接了递归分解和封闭形式，并在许多组合问题中自然出现。