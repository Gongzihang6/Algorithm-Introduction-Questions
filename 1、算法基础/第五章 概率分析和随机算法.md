## 第五章 概率分析和随机算法

### 练习 5.1



5.1-1 证明：假设在过程 HIRE-ASSISTANT 的第 4 行中，我们总能决定哪一个应聘者最佳，则意味着我们知道应聘者排名的全部次序。

5.1-2 请描述 RANDOM(a, b) 过程的一种实现，它只调用 RANDOM(0, 1)。作为 a 和 b 的函数，你的过程的期望运行时间是多少？

5.1-3 假设你希望以 1/2 的概率输出 0 与 1。你可以自由使用一个输出 0 或 1 的过程 BIASED-RANDOM。它以某概率 p 输出 1，概率 1-p 输出 0，其中 0 < p < 1，但是 p 的值未知。请给出一个利用 BIASED-RANDOM 作为子程序的算法，返回一个无偏的结果，能以概率 1/2 返回 0，以概率 1/2 返回 1。作为 p 的函数，你的算法的期望运行时间是多少？



### 练习 5.2

5.2-1 在 HIRE-ASSISTANT 中，假设应聘者以随机顺序出现，你正好雇用一次的概率是多少？正好雇用 n 次的概率是多少？

5.2-2 在 HIRE-ASSISTANT 中，假设应聘者以随机顺序出现，你正好雇用两次的概率是多少？

5.2-3 利用指示器随机变量来计算掷 n 个骰子之和的期望值。

5.2-4 利用指示器随机变量来解如下的帽子核对问题 (hat-check problem)：n 位顾客，他们每个人给餐厅核对帽子的服务生一顶帽子。服务生以随机顺序将帽子归还给顾客。请问拿到自己帽子的客户的期望数是多少？

5.2-5 设 $A[1..n]$ 是由 n 个不同数构成的数列。如果 $i < j$ 且 $A[i] > A[j]$，则称 (i, j) 对为 A 的一个逆序对 (inversion)。(参看思考题 2-4 中更多关于逆序对的例子。) 假设 A 的元素构成 $\langle 1, 2, \cdots, n \rangle$ 上的一个均匀随机排列。请用指示器随机变量来计算其中逆序对的数目期望。

### 练习 5.3

5.3-1 Marceau 教授不同意引理 5.5 证明中使用的循环不变式。他对第 1 次迭代之前循环不变式是否为真提出质疑。他的理由是，我们可以很容易宣称一个空数组不包含 0 排列。因此，一个空的子数组包含一个 0 排列的概率应是 0，从而第 1 次迭代之前循环不变式无效。请重写过程 RANDOMIZE-IN-PLACE，使得相关循环不变式适用于第 1 次迭代之前的非空子数组，并为你的过程修改引理 5.5 的证明。

5.3-2 Kelp 教授决定写一个过程来随机产生除恒等排列 (identity permutation) 外的任意排列。他提出了如下过程：

```c
PERMUTE-WITHOUT-IDENTITY(A)
    n = A.length
    for i = 1 to n - 1
        swap A[i] with A[RANDOM(i + 1, n)]
```

这段代码实现了 Kelp 教授的意图吗？

5.3-3 假设我们不是将元素 $A[i]$ 与子数组 $A[i...n]$ 中的一个随机元素交换，而是将它与数组任何位置上的随机元素交换：

```c
PERMUTE-WITH-ALL(A)
    n = A.length
    for i = 1 to n
        swap A[i] with A[RANDOM(1, n)]
```

这段代码会产生一个均匀随机排列吗？为什么会或为什么不会？

5.3-4 Armstrong 教授建议用下面的过程来产生一个均匀随机排列：

```c
PERMUTE-BY-CYCLIC(A)
    n = A.length
    let B[1..n] be a new array
    offset = RANDOM(1, n)
    for i = 1 to n
        dest = i + offset
        if dest > n
            dest = dest - n
        B[dest] = A[i]
    return B
```

请说明每个元素 A [i] 出现在 B 中任何特定位置的概率是 1/n。然后通过说明排列结果不是均匀随机排列，表明 Armstrong 教授错了。

5.3-5 证明：在过程 PERMUTE-BY-SORTING 的数组 P 中，所有元素都唯一的概率至少是 1−1/n

5.3-6 请解释如何实现算法 PERMUTE-BY-SORTING，以处理两个或更多优先级相同的情形。也就是说，即使有两个或更多优先级相同，你的算法也应该产生一个均匀随机排列。

5.3-7 假设我们希望创建集合 {1,2,3, ⋯, n}的一个随机样本，即一个具有 m 个元素的集合 S，其中 0≤m≤n，使得每个 m 集合能够等可能地创建。一种方法是对 i = 1,2, ⋯, n 设 A [i] = i，调用 RANDOMIZE-IN-PLACE(A)，然后取最前面的 m 个数组元素。这种方法会对 RANDOM 过程调用 n 次。如果 n 比 m 大很多，我们能够创建一个随机样本，只对 RANDOM 调用更少的次数。请说明下面的递归过程返回 {1,2,3, ⋯, n}的一个随机 m 子集 S，其中每个 m 子集是等可能的，然而只对 RANDOM 调用 m 次。

```c
RANDOM-SAMPLE(m, n)
	if m == 0
        return ∅
    else S = RANDOM-SAMPLE(m - 1, n - 1)
        i = RANDOM(1, n)
        if i ∈ S
            S = S ∪ {n}
        else S = S ∪ {i}
        return S
```

### 练习 5.4

5.4-1 一个屋子里必须要有多少人，才能让某人和你生日相同的概率至少为 $1/2$？必须要有多少人，才能让至少两个人生日为 7 月 4 日的概率大于 $1/2$？

5.4-2 假设我们将球投入到 $b$ 个箱子里，直到某个箱子中有两个球。每一次投掷都是独立的，并且每个球落入任何箱子的机会均等。请问投球次数期望是多少？

*5.4-3 在生日悖论的分析中，要求各人生日彼此独立是否很重要？或者，是否只要两两成对独立就足够了？证明你的答案。

*5.4-4 一次聚会需要邀请多少人，才能让其中 3 人的生日很可能相同？

*5.4-5 在大小为 $n$ 的集合中，一个 $k$ 字符串构成一个 $k$ 排列的概率是多少？这个问题和生日悖论有什么关系？

*5.4-6 假设将 $n$ 个球投入 $n$ 个箱子里，其中每次投球独立，并且每个球等可能落入任何箱子。空箱子的数目期望是多少？正好有一个球的箱子的数目期望是多少？

*5.4-7 为使特征序列长度的下界变得更精确，请说明在 $n$ 次硬币的公平抛掷中，不出现比 $\lg n - 2 \lg \lg n$ 更长的连续正面特征序列的概率小于 $1/n$。

### 思考题

5-1 (概率计数) 利用一个 $b$ 位的计数器，我们一般只能计数到 $2^b-1$。而用 R. Morris 的概率计数法，我们可以计数到一个大得多的值，代价是精度有所损失。

对 $i=0,1,\cdots, 2^b-1$，令计数器值 $i$ 表示 $n_i$ 的计数，其中 $n_i$ 构成了一个非负的递增序列。假设计数器初值为 0，表示计数 $n_0=0$。INCREMENT 运算单元工作在一个计数器上，它以概率的方式包含值 $i$。如果 $i=2^b-1$，则该运算单元报告溢出错误；否则，INCREMENT 运算单元以概率 $1/(n_{i+1}-n_i)$ 把计数器增加 1，以概率 $1-1/(n_{i+1}-n_i)$ 保持计数器不变。

对所有的 $i \geqslant 0$，若选择 $n_i=i$，此计数器就是一个普通的计数器。若选择 $n_i=2^{i-1}(i>0)$，或者 $n_i=F_i$ (第 $i$ 个斐波那契数，参见 3.2 节)，则会出现更多有趣的情形。

对于这个问题，假设 $n_{2^b-1}$ 已足够大，发生一个溢出错误的概率可以忽略。

a. 请说明在执行 $n$ 次 INCREMENT 操作后，计数器所表示的数期望值正好是 $n$。

b. 分析计数器表示的计数的方差依赖于 $n_i$ 序列。我们来看一个简单情形：对所有 $i \geqslant 0$，$n_i=100i$。在执行了 $n$ 次 INCREMENT 操作后，请估计计数器所表示数的方差。

5-2 (查找一个无序数组） 本题将分析三个算法，它们在一个包含 $n$ 个元素的无序数组 $A$ 中查 找一个值 $x$。

考虑如下的随机策略：随机挑选 A 中的一个下标 $i$。如果 $A[i]=x$，则终止；否则，继续挑选 A 中一个新的随机下标。重复随机挑选下标，直到找到一个下标 $j$，使 $A[j]=x$，或者直到我们已检查过 A 中的每一个元素。注意，我们每次都是从全部下标的集合中挑选，于是可能会不止一次地检查某个元素。

a. 请写出过程 RANDOM-SEARCH 的伪代码来实现上述策略。确保当 A 中所有下标都被挑选过时，你的算法应停止。

b. 假定恰好有一个下标 $i$ 使得 $A[i]=x$。在我们找到 $x$ 和 RANDOM-SEARCH 结束之前，必须挑选 A 下标的数目期望是多少？

c. 假设有 $k \geqslant 1$ 个下标 $i$ 使得 $A[i]=x$，推广你对 (b) 部分的解答。在找到 $x$ 或 RANDOM-SEARCH 结束之前，必须挑选 A 的下标的数目期望是多少？你的答案应该是 $n$ 和 $k$ 的函数。

d. 假设没有下标 $i$ 使得 $A[i]=x$。在检查完 A 的所有元素或 RANDOM-SEARCH 结束之前，我们必须挑选 A 的下标的数目期望是多少？

现在考虑一个确定性的线性查找算法，我们称之为 DETERMINISTIC-SEARCH。具体地说，这个算法在 A 中顺序查找 $x$，考虑 $A[1]$, $A[2]$, $A[3]$, $\cdots$, $A[n]$，直到找到 $A[i]=x$，或者到达数组的末尾。假设输入数组的所有排列都是等可能的。

e. 假设恰好有一个下标 $i$ 使得 $A[i]=x$。DETERMINISTIC-SEARCH 平均情形的运行时间是多少？DETERMINISTIC-SEARCH 最坏情形的运行时间又是多少？

f. 假设有 $k \geqslant 1$ 个下标 $i$ 使得 $A[i]=x$，推广你对 (e) 部分的解答。DETERMINISTIC-SEARCH 平均情形的运行时间是多少？DETERMINISTIC-SEARCH 最坏情形的运行时间又是多少？你的答案应是 $n$ 与 $k$ 的函数。

g. 假设没有下标 $i$ 使得 $A[i]=x$。DETERMINISTIC-SEARCH 平均情形的运行时间是多少？DETERMINISTIC-SEARCH 最坏情形的运行时间又是多少？

最后，考虑一个随机算法 SCRAMBLE-SEARCH，它先将输入数组随机变换排列，然后在排列变换后的数组上，运行上面的确定性线性查找算法。

h. 设 $k$ 是满足 $A[i]=x$ 的下标的数目，请给出在 $k=0$ 和 $k=1$ 情况下，算法 SCRAMBLE-SEARCH 最坏情形的运行时间和运行时间期望。推广你的解答以处理 $k \geqslant 1$ 的情况。

i. 你将会使用 3 种查找算法中的哪一个？解释你的答案。









